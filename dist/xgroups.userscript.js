// ==UserScript==
// @name         XGroups
// @description  Allows adding x.com users to groups, storing in localStorage, and displaying group tags below avatars
// @namespace    https://github.com/artbit/xgroups
// @author       Djordje Ungar
// @copyright    2025+ Djordje Ungar
// @license      MIT
// @version      1.0.152
// @source       https://github.com/artbit/xgroups
// @homepageURL  https://github.com/artbit/xgroups
// @supportURL   https://github.com/artbit/xgroups/issues
// @updateURL    https://raw.githubusercontent.com/ArtBIT/xgroups/refs/heads/main/dist/xgroups.meta.js
// @downloadURL  https://raw.githubusercontent.com/ArtBIT/xgroups/refs/heads/main/dist/xgroups.userscript.js
// @match        https://x.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=x.com
// @tag          productivity
// @run-at       document-idle
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        GM_notification
// ==/UserScript==

// ==OpenUserJS==
// @author       artbit
// ==/OpenUserJS==

var __defProp=Object.defineProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__publicField=(e,t,r)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,r);(()=>{let i={tweetSelector:'article[data-testid="tweet"]',usernameSelector:'[data-testid="User-Name"] :nth-child(2) a[href^="/"][role="link"] span',avatarSelector:'div[data-testid="Tweet-User-Avatar"]'},p=(...e)=>e.filter(Boolean).join(" "),m=(()=>{let o="https://api.github.com/gists",e=()=>GM_getValue("xgroups_gist_token",""),s=()=>({Accept:"application/vnd.github.v3+json",Authorization:"token "+e(),"Content-Type":"application/json"});return{createGist:async e=>new Promise((r,n)=>{GM_xmlhttpRequest({url:o,method:"POST",headers:s(),nocache:!0,data:JSON.stringify({description:"X.com User Group Tagger Data",public:!1,files:{"xgroups_data.json":{content:JSON.stringify(e,null,2)}}}),onload:e=>{let t;try{t=JSON.parse(e.responseText)}catch(e){n(e)}200!==e.status&&n(new Error("Failed to create Gist"));e=t.id;return GM_setValue("xgroups_gist_id",e),r(e)}})}),readGist:async e=>new Promise((r,n)=>{GM_xmlhttpRequest({url:o+"/"+e,headers:s(),nocache:!0,onload:e=>{let t;try{t=JSON.parse(e.responseText)}catch(e){n(e)}e=t.files;r(JSON.parse(e["xgroups_data.json"].content))}})}),updateGist:async(n,e)=>new Promise((t,r)=>{GM_xmlhttpRequest({url:o+"/"+n,method:"PATCH",headers:s(),nocache:!0,data:JSON.stringify({files:{"xgroups_data.json":{content:JSON.stringify(e,null,2)}}}),onload:e=>{try{JSON.parse(e.responseText)}catch(e){r(e)}200!==e.status&&r(new Error("Failed to update Gist")),t(n)}})}),getToken:e,getGistId:()=>GM_getValue("xgroups_gist_id","")}})();class u{constructor(e,t){this.props=e||{},this.store=t,this.state={},this.element=null,this.unsubscribe=null}setState(e){this.state={...this.state,...e},this.update()}setProps(e){this.props={...this.props,...e},this.update()}render(){return g({tag:"div",textContent:"Base Component"})}mount(e){this.element=this.render(),e.appendChild(this.element),this.store&&(this.unsubscribe=this.store.subscribe(()=>this.update()))}update(){var e;this.element&&(e=this.render(),_(this.element,e))}unmount(){this.element&&(this.element.remove(),this.element=null),this.unsubscribe&&this.unsubscribe()}}let l=["path","circle","rect","line","ellipse","g","polygon","polyline","text","use","defs","symbol","clipPath","mask","pattern"],c="http://www.w3.org/2000/svg",g=({tag:e="div",children:t=[],style:r={},on:n={},element:o,...s})=>{var a="svg"===e||l.includes(e);return o=o||a?document.createElementNS(c,e):document.createElement(e),Object.entries(s).forEach(([e,t])=>{"className"===e?o.setAttribute("class",t):"textContent"===e?o.textContent=t:"innerHTML"===e?o.innerHTML=t:"xlink:href"===e?o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t):o.setAttribute(e,t)}),Object.entries(r).forEach(([e,t])=>{o.style[e]=t}),Object.entries(n).forEach(([e,t])=>{o.addEventListener(e,t)}),t.forEach(e=>{e&&("string"==typeof e?o.appendChild(document.createTextNode(e)):e instanceof Node?o.appendChild(e):e instanceof u?e.mount(o):o.appendChild(g(e)))}),o},d=e=>{setTimeout(e,1)},k=(e={})=>{GM_notification({title:e.title||"XGroups",text:e.text||"This is the notification message.",...e}),GM_log("Notification: "+e.text)},_=(n,e)=>{if(n||e){if(!n)return e;if(e)if(n.tagName!==e.tagName||0===n.childNodes.length&&0===e.childNodes.length)n.replaceWith(e);else{if(0<n.childNodes.length||0<e.childNodes.length){var o=Array.from(n.childNodes),s=Array.from(e.childNodes);for(let e=0;e<Math.max(o.length,s.length);e++){var a=_(o[e],s[e]);a&&n.appendChild(a)}}var l=Array.from(n.attributes),e=Array.from(e.attributes);let t=Object.fromEntries(l.map(e=>[e.name,e.value])),r=Object.fromEntries(e.map(e=>[e.name,e.value]));Object.keys(t).forEach(e=>{e in r||n.removeAttribute(e)}),Object.keys(r).forEach(e=>{t[e]!==r[e]&&n.setAttribute(e,r[e])})}else n.remove()}},e=l=>{let t="xgroups_groups",n="xgroups_user_groups",r="xgroups_data_timestamp",i="xgroups_next_id",o={groups:null,userGroups:null,timestamp:null},p=()=>{var e=parseInt(GM_getValue(i,"1"),10);return GM_setValue(i,(e+1).toString()),e},u=()=>{try{var e=l.getState().groups;JSON.stringify(e)!==JSON.stringify(o.groups)&&(GM_setValue(t,e),a(),o.groups=e)}catch(e){console.error("Failed to save groups:",e),k({text:"Unable to save group data."})}},c=e=>(e||"").replace("@","").toLowerCase(),a=()=>{var e=Date.now();GM_setValue(r,e.toString())};let g=()=>{var e=l.getState();return{groups:e.groups,userGroups:Object.fromEntries(Object.entries(e.userGroups).map(([e,t])=>[e,Array.from(t)])),timestamp:parseInt(GM_getValue(r,"0"),10),formatVersion:1}};let d=()=>{var e,t=l.getState().userGroups;try{JSON.stringify(t)!==JSON.stringify(o.userGroups)&&(e=Object.fromEntries(Object.entries(t).map(([e,t])=>[e,Array.from(t)])),GM_setValue(n,e),a(),o.userGroups={...t})}catch(e){console.error("Failed to save user groups:",e),k({text:"Unable to save user group data."})}};l.setState({groups:(()=>{try{return GM_getValue(t,[]).map(e=>({id:e.id||p(),name:e.name,bgColor:e.bgColor||"#777",fgColor:e.fgColor||"#fff",description:e.description||""}))}catch(e){return console.error("Failed to load groups:",e),[]}})()}),l.setState({userGroups:(()=>{try{var e=GM_getValue(n,{});let r=l.getState().groups;return Object.fromEntries(Object.entries(e).map(([e,t])=>{t=t.map(t=>{var e=r.find(e=>e.id===parseInt(t));return e?e.id:null}).filter(e=>null!==e);return[e,new Set(t)]}))}catch(e){return console.error("Failed to load user groups:",e),{}}})()});let _=()=>l.getState().groups;return{getGroups:_,getGroup:t=>l.getState().groups.find(e=>e.id===t),addGroup:(e,t="",r="#777",n="#fff")=>{e={id:p(),name:e,description:t,bgColor:r,fgColor:n};return l.setState({groups:[...l.getState().groups,e]}),u(),e},removeGroup:t=>{let r=l.getState().userGroups;Object.keys(r).forEach(e=>{r[e].delete(t),0===r[e].size&&delete r[e]}),l.setState({groups:l.getState().groups.filter(e=>e.id!==t),userGroups:{...r}}),u(),d()},updateGroup:(t,r,e,n,o)=>{var s=_(),a=s.findIndex(e=>e.id===t);-1!==a&&(s.some(e=>e.name===r&&e.id!==t)?k({text:"Group with this name already exists."}):(e={...s[a],name:r,description:e,bgColor:n,fgColor:o},s[a]=e,l.setState({groups:s}),u()))},getUserGroups:e=>Array.from(l.getState().userGroups[c(e)]||[]).map(t=>l.getState().groups.find(e=>e.id===t)).filter(Boolean),getUserLink:e=>"https://x.com/"+c(e),getGroupUsers:t=>Object.keys(l.getState().userGroups).filter(e=>l.getState().userGroups[e].has(t)),addUserToGroup:(e,t)=>{e=c(e);var r=l.getState().userGroups;r[e]=r[e]||new Set,r[e].add(t),l.setState({userGroups:{...r}}),d()},removeUserFromGroup:(e,t)=>{e=c(e);var r=l.getState().userGroups;r[e]&&(r[e].delete(t),0===r[e].size&&delete r[e],l.setState({userGroups:{...r}}),d())},normalizeUsername:c,getLocalData:g,importData:e=>{try{let n=JSON.parse(e);if(!n.groups||!n.userGroups)throw new Error("Invalid JSON format");let o=n.groups.map(e=>({id:parseInt(e.id),name:e.name,bgColor:e.bgColor||"#000",fgColor:e.fgColor||"#fff",description:e.description||""})),s={};Object.keys(n.userGroups).forEach(e=>{var t=c(e);let r=new Set;n.userGroups[e].forEach(e=>{let t=parseInt(e);e=o.find(e=>e.id===t);e&&r.add(e.id)}),0<r.size&&(s[t]=r)}),l.setState({groups:o,userGroups:s});var t=Math.max(...o.map(e=>parseInt(e.id)||0),0);return GM_setValue(i,(t+1).toString()),a(),d(),u(),!0}catch(e){return console.error("Failed to import data:",e),k({text:"Invalid JSON file or format."}),!1}},syncWithGist:async()=>{if(m.getToken()&&m.getGistId())try{return await(async(e,r=3,n=1e3)=>{for(let t=0;t<r;t++)try{return await e()}catch(e){if(t===r-1)throw e;await new Promise(e=>setTimeout(e,n*2**t))}})(async()=>{var e=g(),t=parseInt(e.timestamp||"0",10);let s=await m.readGist(m.getGistId());var r=parseInt(s.timestamp||"0",10);if(t<r){let n=s.groups.map(e=>({id:e.id||p(),name:e.name,bgColor:e.bgColor||"#000",fgColor:e.fgColor||"#fff",description:e.description||""})),o={};Object.keys(s.userGroups).forEach(e=>{var t=c(e);let r=new Set;s.userGroups[e].forEach(t=>{var e=n.find(e=>e.id===t||e.name===t);e&&r.add(e.id)}),0<r.size&&(o[t]=r)}),l.setState({groups:n,userGroups:o});var a=Math.max(...n.map(e=>parseInt(e.id)||0),0);GM_setValue(i,(a+1).toString()),u(),d()}else if(r<t)return m.updateGist(m.getGistId(),e)})}catch(e){console.error("Failed to sync with Gist:",e),k({text:"Failed to sync with Gist."})}},createGist:async()=>{if(m.getToken())try{var e=g(),t=await m.createGist(e);return GM_setValue("xgroups_gist_id",t),t}catch(e){console.error("Failed to create Gist:",e),k({text:"Failed to create Gist."})}else k({text:"Please set your Gist token in localStorage."})}}},x={xgroups:"_xgroups_1pkkl_13","form-element":"_form-element_1pkkl_13","form-input":"_form-input_1pkkl_17","group-tags":"_group-tags_1pkkl_29","group-tag":"_group-tag_1pkkl_29","group-tags-btns":"_group-tags-btns_1pkkl_42","svg-btn":"_svg-btn_1pkkl_52","icon-btn":"_icon-btn_1pkkl_59","form-btn":"_form-btn_1pkkl_72","group-tags-btn":"_group-tags-btn_1pkkl_42","settings-btns":"_settings-btns_1pkkl_95","settings-btn":"_settings-btn_1pkkl_95",list:"_list_1pkkl_111","list-item":"_list-item_1pkkl_122","list-item-btns":"_list-item-btns_1pkkl_133","modal-overlay":"_modal-overlay_1pkkl_140","modal-window":"_modal-window_1pkkl_152","modal-header":"_modal-header_1pkkl_162","form-title":"_form-title_1pkkl_169","form-subtitle":"_form-subtitle_1pkkl_173","modal-content":"_modal-content_1pkkl_178","modal-close":"_modal-close_1pkkl_183",active:"_active_1pkkl_193","text-btn":"_text-btn_1pkkl_204","form-footer":"_form-footer_1pkkl_236","label-bg":"_label-bg_1pkkl_294",placeholder:"_placeholder_1pkkl_311","loading-spinner":"_loading-spinner_1pkkl_358","loading-spinner-inner":"_loading-spinner-inner_1pkkl_367","loading-spinner-cutout":"_loading-spinner-cutout_1pkkl_376",hidden:"_hidden_1pkkl_394"};class b extends u{render(){let{options:e,...t}=this.props;return g({tag:"select",className:x["form-input"],children:e.map(({label:e,value:t})=>({tag:"option",value:t,textContent:e})),...t})}}class h extends u{render(){let{type:e,label:t,name:r,value:n="",...o}=this.props;return g({className:x["form-element"],children:[{tag:"input",type:e,name:r,value:n,className:x["form-input"],...o},t&&{tag:"div",className:x["label-bg"],textContent:t},t&&{tag:"label",className:x.placeholder,textContent:t,for:r}]})}}let a={groups:{viewBox:"0 0 24 24",svg:'<g><path d="M7.501 19.917L7.471 21H.472l.029-1.027c.184-6.618 3.736-8.977 7-8.977.963 0 1.95.212 2.87.672-.444.478-.851 1.03-1.212 1.656-.507-.204-1.054-.329-1.658-.329-2.767 0-4.57 2.223-4.938 6.004H7.56c-.023.302-.05.599-.059.917zm8.999-8.921c-3.264 0-6.816 2.358-7 8.977L9.471 21h4.528v-2h-2.438c.367-3.781 2.17-6.004 4.938-6.004 1.089 0 2.022.356 2.784 1.004h2.632c-1.376-2.136-3.446-3.004-5.415-3.004zm0-.996c-.799 0-1.527-.279-2.116-.73C13.548 8.63 13 7.632 13 6.5 13 4.57 14.567 3 16.5 3S20 4.57 20 6.5c0 1.132-.548 2.13-1.384 2.77-.589.451-1.317.73-2.116.73zM15 6.5c0 .827.673 1.5 1.5 1.5S18 7.327 18 6.5 17.327 5 16.5 5 15 5.673 15 6.5zm-11 0C4 4.57 5.567 3 7.5 3S11 4.57 11 6.5 9.433 10 7.5 10 4 8.43 4 6.5zm2 0C6 7.327 6.673 8 7.5 8S9 7.327 9 6.5 8.327 5 7.5 5 6 5.673 6 6.5zM21 21h3v-2h-3v-3h-2v3h-3v2h3v3h2v-3z"></path></g>'},userGroup:{viewBox:"0 0 640 512",svg:'<path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM609.3 512l-137.8 0c5.4-9.4 8.6-20.3 8.6-32l0-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2l61.4 0C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"/>'},pencil:{viewBox:"0 0 512 512",svg:'<path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1 0 32c0 8.8 7.2 16 16 16l32 0zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/>'},trash:{viewBox:"0 0 448 512",svg:'<path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0L284.2 0c12.1 0 23.2 6.8 28.6 17.7L320 32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 96C14.3 96 0 81.7 0 64S14.3 32 32 32l96 0 7.2-14.3zM32 128l384 0 0 320c0 35.3-28.7 64-64 64L96 512c-35.3 0-64-28.7-64-64l0-320zm96 64c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16z"/>'},close:{viewBox:"0 0 512 512",svg:'<path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/>'},import:{viewBox:"0 0 512 512",svg:'<path d="M128 64c0-35.3 28.7-64 64-64L352 0l0 128c0 17.7 14.3 32 32 32l128 0 0 288c0 35.3-28.7 64-64 64l-256 0c-35.3 0-64-28.7-64-64l0-112 174.1 0-39 39c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l39 39L128 288l0-224zm0 224l0 48L24 336c-13.3 0-24-10.7-24-24s10.7-24 24-24l104 0zM512 128l-128 0L384 0 512 128z"/>'},export:{viewBox:"0 0 576 512",svg:'<path d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 128-168 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l168 0 0 112c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zM384 336l0-48 110.1 0-39-39c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l80 80c9.4 9.4 9.4 24.6 0 33.9l-80 80c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l39-39L384 336zm0-208l-128 0L256 0 384 128z"/>'},sync:{viewBox:"0 0 512 512",svg:'<path d="M142.9 142.9c-17.5 17.5-30.1 38-37.8 59.8c-5.9 16.7-24.2 25.4-40.8 19.5s-25.4-24.2-19.5-40.8C55.6 150.7 73.2 122 97.6 97.6c87.2-87.2 228.3-87.5 315.8-1L455 55c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2l0 128c0 13.3-10.7 24-24 24l-8.4 0c0 0 0 0 0 0L344 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l41.1-41.1c-62.6-61.5-163.1-61.2-225.3 1zM16 312c0-13.3 10.7-24 24-24l7.6 0 .7 0L168 288c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-41.1 41.1c62.6 61.5 163.1 61.2 225.3-1c17.5-17.5 30.1-38 37.8-59.8c5.9-16.7 24.2-25.4 40.8-19.5s25.4 24.2 19.5 40.8c-10.8 30.6-28.4 59.3-52.9 83.8c-87.2 87.2-228.3 87.5-315.8 1L57 457c-6.9 6.9-17.2 8.9-26.2 5.2S16 449.7 16 440l0-119.6 0-.7 0-7.6z"/>'},userPlus:{viewBox:"0 0 640 512",svg:'<path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM504 312l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/>'},userMinus:{viewBox:"0 0 640 512",svg:'<path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM472 200l144 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-144 0c-13.3 0-24-10.7-24-24s10.7-24 24-24z"/>'}},r=new class{constructor(){__publicField(this,"isMounted",!1)}mount(){if(!this.isMounted){this.isMounted=!0;var e,t,r=g({tag:"svg",xmlns:c,style:{display:"none"},id:"xgroups-defs"}),n=g({tag:"defs"}),o=(r.appendChild(n),a);for([e,t]of Object.entries(o)){var s=g({tag:"symbol",id:e,viewBox:t.viewBox,innerHTML:t.svg});n.appendChild(s)}document.body.prepend(r)}}unmount(){var e=document.getElementById("xgroups-defs");e&&e.remove()}get(e,t={}){return a[e]?(this.mount(),g({...t,tag:"svg",viewBox:a[e].viewBox,children:[{tag:"use","xlink:href":"#"+e}]})):(console.warn(`SVG icon ${e} not found`),null)}};class o extends u{render(){let{icon:e,...t}=this.props;return r.get(e,t)}}class f extends u{render(){let{icon:e,label:t="",ariaLabel:r,...n}=this.props;return g({...n,tag:"div",role:"button",className:p(x["svg-btn"],x["xgroups-svg-btn"],n.className),"aria-label":r||t,children:[new o({icon:e,title:r||t,className:n.iconClassName}),t&&{tag:"span",textContent:t}]})}}class v extends u{render(){var e=this.store.getState().loading;return g({...this.props,tag:"div",className:p(x["loading-spinner"],!e&&x.hidden),children:[{tag:"div",className:x["loading-spinner-inner"]},{tag:"div",className:x["loading-spinner-cutout"]}]})}}class y extends u{render(){let{title:e,subtitle:t,template:r,onClose:n,active:o}=this.props;return g({tag:"div",className:p(x.xgroups,x["modal-overlay"],o&&x.active),on:{keydown:e=>"Escape"===e.key&&n()},children:[{tag:"div",className:p(x["modal-window"]),children:[{tag:"div",className:x.xgroups,role:"dialog","aria-modal":"true",style:{position:"relative"},children:[{tag:"div",className:x["modal-header"],children:[{tag:"h2",className:x["form-title"],textContent:e},t&&"string"==typeof t&&{tag:"h3",className:x["form-subtitle"],textContent:t},t&&t instanceof HTMLElement&&{tag:"div",className:x["form-subtitle"],children:[t]}]},{tag:"div",className:x["modal-content"],children:[null==r?void 0:r(this.props,this.store)]},new f({icon:"close",className:x["modal-close"],iconClassName:x["modal-close-icon"],title:"Close modal",on:{click:n}})]}]}]})}mount(e){super.mount(e),this.props.active||d(()=>{this.setProps({active:!0})}),this.element.focus()}unmount(){this.element&&(this.setProps({active:!1}),setTimeout(super.unmount.bind(this),200))}}let t=(s,n)=>{let a=(n=>{let o=new Map;let s=()=>{var e=n.getState().modalsStack;e.length&&e.pop().unmount(),n.setState({modalsStack:e})};return n.subscribe(t=>{t=t.modalsStack;if(t.length){let e=t[t.length-1];e.props.active||d(()=>{e.setProps({active:!0})})}}),{register:(e,t)=>{o.set(e,t)},open:(e,t={})=>{var r=o.get(e);if(!r)throw new Error(`Modal ${e} not registered`);t=new y({...t,modalName:e,template:r,onClose:()=>s()},n),e=n.getState().modalsStack||[];e.forEach(e=>{e.setProps({active:!1})}),e.push(t),t.mount(document.body),n.setState({modalsStack:e})},close:s}})(n),t=!0;var e=g({tag:"style",id:"xgroups-styles",textContent:':root {\n  --xgroups-background-primary: #0f1419;\n  --xgroups-background-secondary: #30383f;\n  --xgroups-background-darken: rgba(0, 0, 0, 0.5);\n  --xgroups-background-lighten: rgba(255, 255, 255, 0.1);\n  --xgroups-typography-primary: #eee;\n  --xgroups-typography-secondary: #bbb;\n  --xgroups-typography-inverted: #000;\n  --xgroups-ui-primary: #eff3f4;\n  --xgroups-ui-primary-dimen: #bbb;\n  --xgroups-border-radius: 24px;\n}\n._xgroups_1pkkl_13 ._form-element_1pkkl_13 {\n  position: relative;\n  margin-top: 24px;\n}\n._xgroups_1pkkl_13 ._form-input_1pkkl_17 {\n  background: var(--xgroups-background-secondary);\n  color: var(--xgroups-typography-primary);\n  border: 0;\n  border-radius: var(--xgroups-border-radius);\n  padding: 4px 20px;\n  min-height: 50px;\n  width: 100%;\n}\n._xgroups_1pkkl_13 ._group-circle-btn_1pkkl_26:hover {\n  background: var(--xgroups-background-secondary);\n}\n._xgroups_1pkkl_13._group-tags_1pkkl_29 {\n  margin-top: 5px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n._xgroups_1pkkl_13 ._group-tag_1pkkl_29 {\n  border-radius: 4px;\n  padding: 2px 6px;\n  margin-bottom: 2px;\n  font-size: 16px;\n  cursor: pointer;\n}\n._xgroups_1pkkl_13 ._group-tags-btns_1pkkl_42 {\n  gap: 5px;\n  padding-top: 5px;\n  margin-top: 5px;\n  visibility: hidden;\n  display: flex;\n}\narticle[data-testid="tweet"]:hover ._group-tags-btns_1pkkl_42 {\n  visibility: visible;\n}\n._xgroups_1pkkl_13 ._svg-btn_1pkkl_52 {\n  fill: var(--xgroups-typography-secondary);\n  transition: fill 200ms;\n}\n._xgroups_1pkkl_13 ._svg-btn_1pkkl_52:hover {\n  fill: var(--xgroups-typography-primary);\n}\n._xgroups_1pkkl_13 ._icon-btn_1pkkl_59 {\n  height: 14px;\n  width: 14px;\n}\n._xgroups_1pkkl_13 ._btn_1pkkl_63 {\n  background-color: var(--xgroups-ui-primary-dimen);\n  transition: background-color 200ms;\n}\n._xgroups_1pkkl_13 ._btn_1pkkl_63:hover {\n  background-color: var(--xgroups-ui-primary);\n}\n\n._xgroups_1pkkl_13 input[type="submit"],\n._xgroups_1pkkl_13 ._form-btn_1pkkl_72 {\n  background-color: var(--xgroups-ui-primary-dimen);\n  color: var(--xgroups-typography-inverted);\n  border-radius: 12px;\n  border: 0;\n  box-sizing: border-box;\n  cursor: pointer;\n  font-size: 14px;\n  margin: 4px;\n  padding: 8px;\n  outline: 0;\n  text-align: center;\n  transition: background-color 200ms;\n}\n._xgroups_1pkkl_13 input[type="submit"]:hover,\n._xgroups_1pkkl_13 ._form-btn_1pkkl_72:hover {\n  background-color: var(--xgroups-ui-primary);\n}\n\n._xgroups_1pkkl_13 ._group-tags-btn_1pkkl_42 {\n  width: 100%;\n}\n\n._xgroups_1pkkl_13 ._settings-btns_1pkkl_95 {\n  display: flex;\n  alignitems: flex-start;\n  gap: 8px;\n  margin: 16px 0;\n}\n\n._xgroups_1pkkl_13 ._settings-btn_1pkkl_95 {\n  width: 32px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n._xgroups_1pkkl_13 ._settings-btn_1pkkl_95 svg {\n  height: 32px;\n}\n._xgroups_1pkkl_13 ._list_1pkkl_111 {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  padding: 8px;\n  margin-bottom: 8px;\n  overflow-y: auto;\n  border-radius: var(--xgroups-border-radius);\n  background: var(--xgroups-background-darken);\n}\n\n._xgroups_1pkkl_13 ._list-item_1pkkl_122 {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  justify-content: space-between;\n  padding: 4px 8px;\n  border-radius: var(--xgroups-border-radius);\n}\n._xgroups_1pkkl_13 ._list-item_1pkkl_122:hover {\n  background: var(--xgroups-background-secondary);\n}\n._xgroups_1pkkl_13 ._list-item-btns_1pkkl_133 {\n  display: inline-flex;\n  gap: 16px;\n}\n\n/* MODALS */\n\n._xgroups_1pkkl_13._modal-overlay_1pkkl_140 {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: var(--xgroups-background-darken);\n  z-index: 1002;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n._xgroups_1pkkl_13 ._modal-window_1pkkl_152 {\n  color: var(--xgroups-typography-primary);\n  background: var(--xgroups-background-primary);\n  border: none;\n  padding: 16px;\n  max-width: 400px;\n  width: 100%;\n  box-shadow: 0 0px 64px var(--xgroups-background-lighten);\n  border-radius: var(--xgroups-border-radius);\n}\n._xgroups_1pkkl_13 ._modal-header_1pkkl_162 {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 10px;\n  flex-direction: column;\n}\n._xgroups_1pkkl_13 ._modal-header_1pkkl_162 ._form-title_1pkkl_169 {\n  font-size: 20px;\n  margin: 0;\n}\n._xgroups_1pkkl_13 ._modal-header_1pkkl_162 ._form-subtitle_1pkkl_173 {\n  font-size: 14px;\n  color: #aaa;\n  margin: 0;\n}\n._xgroups_1pkkl_13 ._modal-content_1pkkl_178 {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n._xgroups_1pkkl_13 ._modal-close_1pkkl_183 {\n  position: absolute;\n  top: 0px;\n  right: 0px;\n  width: 24px;\n}\n._xgroups_1pkkl_13._modal-overlay_1pkkl_140 {\n  opacity: 0;\n  transition: opacity 200ms ease-in-out;\n}\n._xgroups_1pkkl_13._modal-overlay_1pkkl_140._active_1pkkl_193 {\n  opacity: 1;\n}\n._xgroups_1pkkl_13._modal-overlay_1pkkl_140._active_1pkkl_193 ._modal-window_1pkkl_152 {\n  transform: scale(1);\n}\n._xgroups_1pkkl_13 ._modal-window_1pkkl_152 {\n  transform: scale(0.8);\n  transition: transform 200ms ease-in-out;\n}\n\n._xgroups_1pkkl_13 ._text-btn_1pkkl_204 {\n  background-color: none;\n  color: var(--xgroups-typography-secondary);\n  border-radius: 12px;\n  border: 0;\n  box-sizing: border-box;\n  cursor: pointer;\n  font-size: 14px;\n  margin: 4px;\n  padding: 4px;\n  outline: 0;\n  text-align: center;\n}\n._xgroups_1pkkl_13 ._text-btn_1pkkl_204:hover {\n  color: var(--xgroups-typography-primary);\n  text-decoration: underline;\n}\n._xgroups_1pkkl_13 form {\n  padding: 0px;\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  background-color: var(--xgroups-background-primary);\n  border-radius: var(--xgroups-border-radius);\n  box-sizing: border-box;\n}\n._xgroups_1pkkl_13 ._form-title_1pkkl_169 {\n  color: var(--xgroups-typography-primary);\n  font-family: sans-serif;\n  font-size: 24px;\n  font-weight: 600;\n}\n._xgroups_1pkkl_13 ._form-footer_1pkkl_236 {\n  color: var(--xgroups-typography-secondary);\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  margin-top: 16px;\n}\n._xgroups_1pkkl_13 select {\n  padding: 12px;\n  border-radius: var(--xgroups-border-radius);\n  background: var(--xgroups-background-secondary);\n}\n._xgroups_1pkkl_13 ._form-subtitle_1pkkl_173 {\n  color: var(--xgroups-typography-primary);\n  font-family: sans-serif;\n  font-size: 16px;\n  font-weight: 600;\n  margin-top: 8px;\n}\n._xgroups_1pkkl_13 ._form-element_1pkkl_13 {\n  min-height: 50px;\n  height: auto;\n  position: relative;\n  width: 100%;\n  margin-top: 24px;\n}\n._xgroups_1pkkl_13 ._divider_1pkkl_262 {\n  width: 100%;\n  height: 1px;\n  background-color: var(--xgroups-background-secondary);\n  margin: 20px 0;\n}\n._xgroups_1pkkl_13 ._form-input_1pkkl_17,\n._xgroups_1pkkl_13 input {\n  color: var(--xgroups-typography-primary);\n  background-color: var(--xgroups-background-secondary);\n  border-radius: var(--xgroups-border-radius);\n  border: 0;\n  box-sizing: border-box;\n  font-size: 18px;\n  min-height: 50px;\n  height: 100%;\n  outline: 0;\n  padding: 4px 20px;\n  width: 100%;\n}\n._xgroups_1pkkl_13 input[type="color"] {\n  -webkit-appearance: none;\n  width: 100%;\n  height: 50px;\n}\n._xgroups_1pkkl_13 input[type="color"],\n._xgroups_1pkkl_13 input[type="color"]::-webkit-color-swatch,\n._xgroups_1pkkl_13 input[type="color"]::-webkit-color-swatch-wrapper {\n  border: none;\n  border-radius: var(--xgroups-border-radius);\n  padding: 0;\n}\n._xgroups_1pkkl_13 ._label-bg_1pkkl_294 {\n  background-color: var(--xgroups-background-primary);\n  border-radius: 10px;\n  padding: 4px 10px;\n  height: 20px;\n  position: absolute;\n  top: -28px;\n  left: 20px;\n  transform: translateY(0);\n  transition: transform 200ms;\n  color: transparent;\n}\n._xgroups_1pkkl_13 ._form-input_1pkkl_17._focus_1pkkl_306 ~ ._label-bg_1pkkl_294,\n._xgroups_1pkkl_13 input:focus ~ ._label-bg_1pkkl_294,\n._xgroups_1pkkl_13 input:not(:placeholder-shown) ~ ._label-bg_1pkkl_294 {\n  transform: translateY(14px);\n}\n._xgroups_1pkkl_13 ._placeholder_1pkkl_311 {\n  color: var(--xgroups-typography-secondary);\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  pointer-events: none;\n  transform-origin: 0 50%;\n  transition:\n    transform 200ms,\n    color 200ms;\n  transform: scale(1.2);\n}\n._xgroups_1pkkl_13 ._label-bg_1pkkl_294,\n._xgroups_1pkkl_13 ._placeholder_1pkkl_311 {\n  font-family: sans-serif;\n  font-size: 14px;\n  line-height: 14px;\n}\n._xgroups_1pkkl_13 ._form-input_1pkkl_17._focus_1pkkl_306 ~ ._placeholder_1pkkl_311,\n._xgroups_1pkkl_13 ._form-input_1pkkl_17 ._placeholder-shown_1pkkl_330,\n._xgroups_1pkkl_13 input:focus ~ ._placeholder_1pkkl_311,\n._xgroups_1pkkl_13 input:not(:placeholder-shown) ~ ._placeholder_1pkkl_311 {\n  transform: translateY(-34px) translateX(9px) scale(1);\n}\n._xgroups_1pkkl_13 input:not(:placeholder-shown) ~ ._placeholder_1pkkl_311 {\n  color: var(--xgroups-typography-secondary);\n}\n._xgroups_1pkkl_13 input:focus ~ ._placeholder_1pkkl_311 {\n  color: var(--xgroups-typography-tertiary);\n}\n._xgroups_1pkkl_13 ._submit_1pkkl_341 {\n  background-color: var(--xgroups-ui-primary);\n  color: var(--xgroups-typography-primary);\n  border-radius: 12px;\n  border: 0;\n  box-sizing: border-box;\n  cursor: pointer;\n  font-size: 18px;\n  height: 50px;\n  margin-top: 24px;\n  outline: 0;\n  text-align: center;\n  width: 100%;\n}\n._xgroups_1pkkl_13 ._submit_1pkkl_341:active {\n  background-color: var(--xgroups-ui-secondary);\n}\n._xgroups_1pkkl_13 ._loading-spinner_1pkkl_358 {\n  position: relative;\n  display: inline-block;\n  top: 6px;\n  width: 24px;\n  height: 24px;\n  margin: 0 auto;\n  animation: _spin_1pkkl_1 1s linear infinite;\n}\n._xgroups_1pkkl_13 ._loading-spinner-inner_1pkkl_367 {\n  position: absolute;\n  width: 50%;\n  height: 50%;\n  top: 0;\n  left: 0;\n  background-color: var(--xgroups-ui-primary);\n  border-radius: 100% 0 0 0;\n}\n._xgroups_1pkkl_13 ._loading-spinner-cutout_1pkkl_376 {\n  width: 50%;\n  height: 50%;\n  background-color: var(--xgroups-background-primary);\n  position: absolute;\n  top: 25%;\n  left: 25%;\n  border-radius: 50%;\n  pointer-events: none;\n}\n@keyframes _spin_1pkkl_1 {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n._xgroups_1pkkl_13 ._hidden_1pkkl_394 {\n  display: none;\n}\n'});document.head.appendChild(e),a.register("groupManager",(e,t)=>g({tag:"div",className:x.xgroups,children:[{className:x["settings-btns"],children:[new f({icon:"import",title:"Import groups from JSON",className:x["settings-btn"],on:{click:()=>{a.open("importData",{title:"Import Data",subtitle:"Paste your JSON data"})}}}),new f({icon:"export",title:"Export groups to JSON",className:x["settings-btn"],on:{click:()=>{var e=JSON.stringify(s.getLocalData()),e=new Blob([e],{type:"application/json"}),e=URL.createObjectURL(e),t=g({tag:"a",href:e,download:"xgroups.json",style:{display:"none"}});document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}}}),new f({icon:"sync",title:"Sync with Gist",className:x["settings-btn"],on:{click:()=>{a.open("gistSettings",{title:"Gist Settings"})}}})]},{tag:"div",className:x.list,style:{maxHeight:"300px"},children:[...t.getState().groups.map(e=>({tag:"div",className:x["list-item"],children:[{tag:"button",textContent:`${e.name} (${s.getGroupUsers(e.id).length})`,title:e.description,on:{click:()=>{a.open("groupUsers",{groupId:e.id,title:"Users in Group: "+e.name,subtitle:g({tag:"button",textContent:"Edit group...",className:x["text-btn"],on:{click:()=>a.open("editGroup",{group:e,title:"Edit Group"})}})})}}},{tag:"div",className:x["list-item-btns"],children:[new f({icon:"pencil",title:"Edit group",className:x["icon-btn"],on:{click:()=>{a.open("editGroup",{group:e,title:"Edit Group"})}}}),new f({icon:"trash",title:"Remove group",className:x["icon-btn"],on:{click:()=>{0<s.getGroupUsers(e.id).length&&!confirm(`Are you sure you want to remove the group "${e.name}"?`)||s.removeGroup(e.id)}}})]}]}))]},{tag:"button",textContent:"Add Group",className:x["form-btn"],on:{click:()=>{a.open("addGroup",{title:"Add Group"})}}}]})),a.register("gistSettings",(e,t)=>g({tag:"form",className:x.xgroups,on:{submit:async e=>{e.preventDefault();var t=e.target.elements.token.value,r=e.target.elements.gistId.value;if("cancel"===e.submitter.name)a.close();else if(t){if(GM_setValue("xgroups_gist_token",t),r)GM_setValue("xgroups_gist_id",r);else try{var n=await s.createGist();n&&k({text:"Gist created: https://gist.github.com/"+n,url:"https://gist.github.com/"+n})}catch(e){return console.error("Failed to create Gist:",e),void k({text:"Failed to create Gist. Check your token."})}await s.syncWithGist(),a.close()}else k({text:"Please enter a GitHub Personal Access Token."})}},children:[new h({type:"text",label:"GitHub Personal Access Token",name:"token",value:GM_getValue("xgroups_gist_token","")},t).render(),new h({type:"text",label:"Gist ID (leave blank to create new)",name:"gistId",value:GM_getValue("xgroups_gist_id","")},t).render(),{tag:"p",children:[{tag:"a",textContent:"Generate new Personal Access Token?",href:"https://github.com/settings/personal-access-tokens/new",target:"_blank",style:{color:"var(--xgroups-ui-primary)",textDecoration:"underline"}},{tag:"span",textContent:" (only allow 'gist' scope)"}]},g({className:x["form-footer"],children:[{tag:"button",type:"submit",name:"cancel",className:x["form-btn"],textContent:"Cancel"},{tag:"button",type:"submit",name:"save",className:x["form-btn"],textContent:"Save"},{tag:"button",type:"button",name:"sync",className:x["form-btn"],textContent:"Sync Now",on:{click:async()=>{t.setState({loading:!0});var e=await s.syncWithGist();t.setState({loading:!1}),e&&(k({text:"Gist updated: https://gist.github.com/"+e,url:"https://gist.github.com/"+e}),a.close())}}},{tag:"span",children:[new v({},t)]}]})]})),a.register("importData",(e,t)=>g({tag:"form",className:x.xgroups,on:{submit:e=>{e.preventDefault();e=e.target.elements.jsonData.value;s.importData(e)?a.close():k({text:"Invalid JSON data."})}},children:[{tag:"textarea",className:x["form-input"],placeholder:"Paste your JSON data here",rows:20,on:{input:e=>{e=e.target.value;s.importData(e)&&a.close()}}},{tag:"button",textContent:"Import",className:x["form-btn"],type:"submit"}]})),a.register("editGroup",({group:o},e)=>g({tag:"form",className:x.xgroups,on:{submit:e=>{var t,r,n;e.preventDefault(),"cancel"===e.submitter.name?a.close():(t=e.target.elements.name.value,r=e.target.elements.description.value,n=e.target.elements.bgColor.value,e=e.target.elements.fgColor.value,t?(s.updateGroup(o.id,t,r,n,e),a.close()):k({text:"Please enter a group name."}))}},children:[new h({type:"text",label:"Group Name",name:"name",value:o.name},e).render(),new h({type:"text",label:"Description",name:"description",value:o.description},e).render(),new h({type:"color",label:"Background Color",name:"bgColor",value:o.bgColor},e).render(),new h({type:"color",label:"Text Color",name:"fgColor",value:o.fgColor},e).render(),g({className:x["form-footer"],children:[{tag:"button",type:"submit",name:"cancel",className:x["form-btn"],textContent:"Cancel"},{tag:"button",type:"submit",name:"save",className:x["form-btn"],textContent:"Save Changes"}]})]})),a.register("addGroup",(e,t)=>g({tag:"form",className:x.xgroups,on:{submit:e=>{e.preventDefault();var t=e.target.elements.name.value,r=e.target.elements.description.value,n=e.target.elements.bgColor.value,e=e.target.elements.fgColor.value;t?(s.addGroup(t,r,n,e),a.close()):k({text:"Please enter a group name."})}},children:[new h({type:"text",label:"Group Name",name:"name"},t).render(),new h({type:"text",label:"Description",name:"description"},t).render(),new h({type:"color",label:"Background Color",name:"bgColor",value:"#777777"},t).render(),new h({type:"color",label:"Text Color",name:"fgColor",value:"#ffffff"},t).render(),g({className:x["form-footer"],children:[{tag:"button",type:"submit",name:"cancel",className:x["form-btn"],textContent:"Cancel"},{tag:"button",type:"submit",name:"addGroup",className:x["form-btn"],textContent:"Add Group"}]})]})),a.register("groupUsers",(t,e)=>g({tag:"div",className:x.xgroups,children:[{tag:"div",className:x.list,style:{maxHeight:"300px"},children:s.getGroupUsers(t.groupId).map(e=>({tag:"div",className:x["list-item"],children:[{tag:"a",textContent:"@"+e,href:s.getUserLink(e),target:"_blank"},new f({icon:"trash",className:x["icon-btn"],title:"Remove user from group",on:{click:()=>{s.removeUserFromGroup(e,t.groupId)}}})]}))},{className:x["form-footer"],children:[{tag:"button",type:"submit",name:"close",className:x["form-btn"],textContent:"Close",on:{click:()=>{a.close()}}}]}]})),a.register("assignUser",({username:n},e)=>g({tag:"form",className:x.xgroups,on:{submit:e=>{e.preventDefault();var t="NEW"===e.target.elements.group.value,r=parseInt(e.target.elements.group.value);"cancel"===e.submitter.name?a.close():t?(e=prompt("Enter new group name:"))&&(t=s.addGroup(e),s.addUserToGroup(n,t.id),a.close()):r?(s.addUserToGroup(n,r),a.close()):k({text:"Please select a group."})}},children:[new h({type:"text",label:"Assign User to Group",name:"username",value:n,readOnly:!0,style:{cursor:"not-allowed"}},e).render(),new b({name:"group",options:[...e.getState().groups.map(e=>({label:e.name+" "+e.description,value:e.id})),{label:"Create New",value:"NEW"}],on:{change:e=>{"NEW"===e.target.value&&a.open("addGroup",{title:"Add New Group"})}}},e).render(),g({className:x["form-footer"],children:[{tag:"button",type:"submit",name:"cancel",className:x["form-btn"],textContent:"Cancel"},{tag:"button",type:"submit",name:"assign",className:x["form-btn"],textContent:"Assign"}]})]})),a.register("removeUser",({username:r},e)=>g({tag:"form",className:x.xgroups,on:{submit:e=>{e.preventDefault();var t=parseInt(e.target.elements.group.value);"cancel"===e.submitter.name?a.close():t?(s.removeUserFromGroup(r,t),a.close()):k({text:"Please select a group."})}},children:[new h({type:"text",label:"Remove User from Group",name:"username",value:r,readOnly:!0,style:{cursor:"not-allowed"}},e).render(),new b({name:"group",options:s.getUserGroups(r).map(e=>({label:e.name+" "+e.description,value:e.id}))},e).render(),g({className:x["form-footer"],children:[{tag:"button",type:"submit",name:"cancel",className:x["form-btn"],textContent:"Cancel"},{tag:"button",type:"submit",name:"remove",title:"Remove user from group",className:x["form-btn"],textContent:"Remove"}]})]}));class o extends u{render(){let e=this.props.username;var t=s.getUserGroups(e);return g({className:p(x.xgroups,x["group-tags"]),children:[...t.map(e=>g({tag:"span",className:x["group-tag"],textContent:e.name,title:e.description,style:{background:e.bgColor,color:e.fgColor},on:{click:()=>a.open("groupUsers",{groupId:e.id,title:"Users in Group: "+e.name,subtitle:g({tag:"button",textContent:"Edit group...",className:x["text-btn"],on:{click:()=>a.open("editGroup",{group:e,title:"Edit Group"})}})})}})),{className:x["group-tags-btns"],children:[new f({icon:"userPlus",title:"Add user to group",iconClassName:x["group-tags-btn"],"aria-label":"Add user to group",on:{click:()=>a.open("assignUser",{username:e,title:"Add to Group"})}}),new f({icon:"userMinus",title:"Remove user from group",iconClassName:x["group-tags-btn"],"aria-label":"- Remove user from group",on:{click:()=>a.open("removeUser",{username:e,title:"Remove User from Group"})}})]}]})}}let r=e=>{var t,r;e&&e.querySelector&&(t=e.querySelector(i.usernameSelector)||e.querySelector(i.usernameLinkSelector))&&(t=s.normalizeUsername(t.textContent),e=e.querySelector(i.avatarSelector))&&((r=e.querySelector("."+x["group-tags"]))&&r.remove(),new o({username:t},n).mount(e))};e=g({className:x.xgroups,children:[new f({title:"Manage XGroups",icon:"groups",className:x["icon-btn"],style:{position:"fixed",top:"10px",right:"10px",width:"24px",height:"24px",zIndex:1001},on:{click:()=>a.open("groupManager",{title:"Manage Groups"})}},n)]}),document.body.appendChild(e),s.syncWithGist();let l=((t,r)=>{let n;return(...e)=>{clearTimeout(n),n=setTimeout(()=>t(...e),r)}})(()=>{t=!1,console.log("Updating group tags..."),document.querySelectorAll(i.tweetSelector).forEach(r),setTimeout(()=>{t=!0},1)},100);return l(),new MutationObserver(e=>{t&&e.forEach(e=>{Array.from(e.addedNodes).forEach(r)})}).observe(document.body,{childList:!0,subtree:!0}),n.subscribe(e=>{(e.groups||e.userGroups)&&l()}),{updateGroupTags:l}};class n{constructor(){this.store=(e=>{let t={...e},r=new Set;return{getState:()=>t,setState:e=>{t={...t,...e},r.forEach(e=>e(t))},subscribe:e=>(r.add(e),()=>r.delete(e))}})({groups:[],userGroups:{},modalsStack:[],loading:!1}),this.dataAPI=e(this.store),this.uiManager=t(this.dataAPI,this.store)}}new n})();